<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xiaomi.infrastructure.persistent.dao.UserDao">

    <!-- 定义查询结果映射 -->
    <resultMap id="BaseResultMap" type="com.xiaomi.infrastructure.persistent.po.User">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="email" property="email" />
    </resultMap>

    <!-- 查询用户信息（基于 userId 和 tbIdx） -->
    <select id="queryUserInfoByUserId" parameterType="String"
            resultMap="BaseResultMap">
        SELECT id, name, email
        FROM user  <!-- 动态表名 -->
        WHERE id = #{userId}  <!-- 查询条件为 id -->
    </select>

    <!-- 插入用户信息（基于 tbIdx） -->
    <insert id="insertUser" parameterType="com.xiaomi.infrastructure.persistent.po.User">
        INSERT INTO user (id,name, email)
        VALUES ( #{id},#{name}, #{email})
    </insert>

    <!-- 基于 email 模糊查询用户信息（基于 tbIdx） -->
    <select id="queryUserByEmail" parameterType="String" resultMap="BaseResultMap">
        SELECT id, name, email
        FROM user  <!-- 动态表名 -->
        WHERE email LIKE CONCAT('%', #{email}, '%')
    </select>

</mapper>
